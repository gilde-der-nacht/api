<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
body {
    width: 40em;
    margin: 1em auto;
}
</style>
<script src="app.js"></script>
<script>
'use strict';

async function main() {
    console.info('tests started');

    const app = new App();

    // test the service with raw get/post/put/delete methods

    // this ressource is empty forever
    const UID_EMPTY = 'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';
    const PATH_EMPTY = '/resources/' + UID_EMPTY + '/entries';

    // this ressource is just to add anything you like, entries may be deleted occasionally by an administrator
    const UID_TEST = '095da522f49aebbd35443fd2349d578a1aaf4a9ea05ae7d59383a5f416d4fd3b';
    const PATH_TEST = '/resources/' + UID_TEST + '/entries';

    const JSON_EMPTY = {'publicBody': {}, 'privateBody': {}};
    const JSON_EMPTY_STRING = JSON.stringify(JSON_EMPTY);

    {
        const [_, status] = await http_get('/invalid-url');
        console.assert(status === HTTP_404_NOT_FOUND);

        console.assert((await http_get('/invalid-url'))[1] === HTTP_404_NOT_FOUND);
    }

    {
        console.assert((await http_put(PATH_EMPTY, JSON_EMPTY_STRING))[1] === HTTP_405_METHOD_NOT_ALLOWED);

        console.assert((await http_delete(PATH_EMPTY))[1] === HTTP_405_METHOD_NOT_ALLOWED);

        console.assert((await http_post(PATH_TEST, JSON_EMPTY_STRING))[1] === HTTP_201_CREATED);

        console.assert((await http_get(PATH_TEST))[1] === HTTP_200_OK);
    }

    // test the service with the library the client uses

    {
        const status = await app.status();
        console.assert('version' in status);
        console.assert('time' in status);
        console.assert(status.version === '0.0.0');
    }

    {
        console.assert(!App._verifyBody('{}'));
        console.assert(App._verifyBody({}));

        console.assert(!App._verifyUid(''));
        console.assert(!App._verifyUid('0'));
        console.assert(!App._verifyUid('01234567890123456789012345678901234567890123456789012345678901234'));
        console.assert(App._verifyUid('0123456789012345678901234567890123456789012345678901234567890123'));
    }

    {
        // add one element
        const length1 = (await app.resourcelistAll(UID_TEST)).length;
        await app.resourceAdd(UID_TEST, JSON_EMPTY, JSON_EMPTY);
        const length2 = (await app.resourcelistAll(UID_TEST)).length;
        console.assert((length1 + 1) == length2);
    }

    console.info('tests finished');
}

window.addEventListener('load', main);
</script>
</head>
<body>

<h1>Test</h1>

<p>open developer tools for results</p>

</body>
</html>
